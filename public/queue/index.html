<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Simple and efficient purely functional queues and deques - SkqLiao&#39;s Blog</title><meta name="description" content=""><meta property="og:title" content="Simple and efficient purely functional queues and deques" />
<meta property="og:description" content="纯函数式实现队列（queue）和双端队列（deque），使得单次操作的最坏复杂度为 $O(1)$。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://skqliao.github.io/queue/" /><meta property="og:image" content="https://skqliao.github.io/queue/featured-image.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-08T12:24:15+08:00" />
<meta property="article:modified_time" content="2023-10-08T12:24:15+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://skqliao.github.io/queue/featured-image.webp"/>
<meta name="twitter:title" content="Simple and efficient purely functional queues and deques"/>
<meta name="twitter:description" content="纯函数式实现队列（queue）和双端队列（deque），使得单次操作的最坏复杂度为 $O(1)$。"/>
<meta name="application-name" content="SkqLiao&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="SkqLiao&#39;s Blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://skqliao.github.io/queue/" /><link rel="prev" href="https://skqliao.github.io/atcoder-sol/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Simple and efficient purely functional queues and deques",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/skqliao.github.io\/queue\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/skqliao.github.io\/queue\/featured-image.webp",
                            "width":  1420 ,
                            "height":  708 
                        }],"genre": "posts","keywords": "数据结构, Haskell","wordcount":  2919 ,
        "url": "https:\/\/skqliao.github.io\/queue\/","datePublished": "2023-10-08T12:24:15+08:00","dateModified": "2023-10-08T12:24:15+08:00","publisher": {
            "@type": "Organization",
            "name": "SkqLiao"},"author": {
                "@type": "Person",
                "name": "SkqLiao"
            },"description": ""
    }
    </script></head><body data-header-desktop="" data-header-mobile=""><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="SkqLiao&#39;s Blog">SkqLiao&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                    <i class="fa-solid fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="SkqLiao&#39;s Blog">SkqLiao&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><div class="menu-item"><a href="#" onclick="return false;" class="theme-switch" title="切换主题">
                    <i class="fa-solid fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Simple and efficient purely functional queues and deques</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fa-solid fa-user-circle fa-fw"></i>SkqLiao</a></span>&nbsp;<span class="post-category">出版于  <a href="/categories/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"><i class="fa-regular fa-folder fa-fw"></i>函数式编程</a></span></div>
                <div class="post-meta-line"><span><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-10-08">2023-10-08</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 2919 字</span>&nbsp;
                    <span><i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>目录</span>
                        <span><i class="details-icon fa-solid fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#路径">路径</a></li>
    <li><a href="#实现">实现</a>
      <ul>
        <li><a href="#paired-list">Paired List</a>
          <ul>
            <li><a href="#代码实现">代码实现</a></li>
          </ul>
        </li>
        <li><a href="#paired-lazy-liststream">Paired Lazy List(Stream)</a>
          <ul>
            <li><a href="#代码实现-1">代码实现</a></li>
          </ul>
        </li>
        <li><a href="#with-pre-evaluation">With pre-evaluation</a>
          <ul>
            <li><a href="#代码">代码</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#备注">备注</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><p>纯函数式实现队列（queue）和双端队列（deque），使得单次操作的最坏复杂度为 $O(1)$。</p>
<h2 id="路径">路径</h2>
<ul>
<li>经典方法 paired list：单次操作的均摊复杂度 $O(1)$，但最坏复杂度为 $O(n)$</li>
<li>使用lazy list替换list：单次操作的最坏复杂度为 $O(\log{n})$</li>
<li>使用incrementally pre-evaluating lazy list：单次操作的最坏复杂度为 $O(1)$</li>
<li>从queue拓展到deque</li>
</ul>
<h2 id="实现">实现</h2>
<h3 id="paired-list">Paired List</h3>
<p>标准的paired list的实现方式是使用两个list（或者说stack）$\langle L,R\rangle$ 分别存储当前队列 $q$ 的左右子区间，其中 $L$ 是倒序的（栈顶为<code>q.front</code>），$R$ 是正序的（栈顶为<code>q.back</code>）</p>
<p>这个trick很经典，直接给出操作函数：
$$
\begin{aligned}
f(x)&amp;=1 \
&amp;=2 \
&amp;=3 \
\end{aligned}
$$</p>
<p>具体解释为：</p>
<ul>
<li>
<p>执行 $\text{insert}$ 时，在 $R$ 的栈顶处插入，即 $\langle L,e:R\rangle$</p>
</li>
<li>
<p>执行 $\text{remove}$ 时：</p>
<ul>
<li>若 $L$ 非空，则将 $L$ 的栈顶元素弹出，即 $\langle \text{tl}\ L,R\rangle$</li>
<li>若 $L$ 为空，则将 $R$ 中元素依次弹出，并插入 $L$ 中（由于stack是FILO的，因此相当于将R翻转后赋值给L，并清空R，即$\langle\text{rev}\ R,[]\rangle$，再得到 $\langle \text{tl}\ L,R\rangle$</li>
</ul>
</li>
</ul>
<p>由于每个元素至多在 $L,R$ 插入/弹出各一次，因此单次操作的均摊时间复杂度为 $O(1)$。</p>
<p>但是这个做法有一个问题：当执行 $\text{remove}$ 且 $L$ 为空的情况时，单次操作需要 $O(|R|)$ 的时间（即翻转列表/栈中元素素全部弹出），这在部分应用场景下不可接受。</p>
<h4 id="代码实现">代码实现</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="c1">-- 使用元组来表示成对的列表</span>
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="kt">PairedList</span> <span class="n">a</span> <span class="ow">=</span> <span class="p">([</span><span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 队列类型</span>
</span></span><span class="line"><span class="cl"><span class="kr">newtype</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">PairedList</span> <span class="n">a</span><span class="p">)</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 创建一个空队列</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 将元素添加到队列末尾</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="n">x</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="kt">:</span><span class="n">rear</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">rr</span><span class="p">))</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="n">ll</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">[]</span> <span class="ow">-&gt;</span> <span class="n">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">rr</span><span class="p">,</span> <span class="kt">[]</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">xs</span> <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">head</span> <span class="n">xs</span><span class="p">,</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">rr</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 从队列前部取出元素，并返回新的队列</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">))</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="n">front</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">[]</span> <span class="ow">-&gt;</span> <span class="n">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">rear</span><span class="p">,</span> <span class="kt">[]</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">rear</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 检查队列是否为空</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">True</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="ow">=</span> <span class="n">length</span> <span class="n">x</span> <span class="o">+</span> <span class="n">length</span> <span class="n">y</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="paired-lazy-liststream">Paired Lazy List(Stream)</h3>
<p>Lazy List的优势在于操作可以延迟，直到对应元素访问时才执行，且中间结果是记忆化的。</p>
<p>对于Lazy List：
$$
\begin{align*}
X\texttt{++} Y&amp;=Y&amp;&amp;{|X|=0}\
&amp;=\text{hd}\ X:(\text{tl}\ X\texttt{++}Y)&amp;&amp;{|X|&gt;0}\</p>
<p>\text{rev}\ X &amp;= \text{rev}&rsquo;(X, []) \
&amp;\phantom{\text{rev}\ X} \text{where } \text{rev}&rsquo;(X, A) = A &amp;&amp;  {|X| = 0} \
&amp;\phantom{\text{rev}\ X\text{where } \text{rev}&rsquo;(X, A)} = \text{rev}&rsquo;(\text{tl}\ X, \text{hd}\ X:A) &amp;&amp;  {|X| &gt; 0} \
\text{take}(n, X) &amp;= [] &amp;&amp;  {n = 0} \
&amp;= \text{hd}\ X:\text{take}(n-1,\text{tl}\ X) &amp;&amp;  {n &gt; 0} \
\text{drop}(n, X) &amp;= X &amp;&amp;  {n = 0} \
&amp;= \text{hd}\ X:\text{drop}(n-1,\text{tl}\ X) &amp;&amp;  {n &gt; 0}
\end{align*}
$$
其中，$\texttt{++}$ 和 $\text{take}$ 是增量的（incremental），即其中部分操作可以延迟到需要取出对应位置的元素时再执行；而 $\text{rev}$ 和 $\text{drop}$ 不是增量的，需要一次性将所有操作全部执行完成。</p>
<p>为了避免执行 $\text{rev}\ R$ 操作时的复杂度过高，我们需要提前执行该操作（而不是等到 $L$ 为空时再执行，此时 $|R|$ 太大了）。</p>
<p>周期性对 $\langle L,R\rangle$ 执行 $\langle{L\texttt{++}\text{rev}\ R, []}\rangle$，将这一操作称为 $\text{rot}$。</p>
<p>定义 $\text{rot}(L,R,[])=L\texttt{++}\text{rev}\ R$，用 $A$ 存储当前已经翻转的列表元素，则：
$$
\begin{align*}
\text{rot}(L,R,A)&amp;=\text{hd}\ R:A &amp;&amp; {|L|=0}\
&amp;=\text{hd}\ L:\text{rot}(\text{hd}\ L,\text{tl}\ R,\text{hd}\ R:A)&amp;&amp; {|L|&gt;0}\
\end{align*}
$$
由于 $\texttt{++}$ 是增量的，因此只要选择一个合适的周期，即可降低每次执行 $\text{rot}$ 操作时的复杂度。显然，当 $|R|=|L|+1$ 时最优。</p>
<p>如此，执行执行 $\text{remove}$ 时的最坏时间复杂度为 $O(\log{n})$（因为每次。</p>
<p>总结一下，操作函数为：
$$
\begin{alignat*}{3}
&amp;[]_q &amp;&amp;= \langle [],[]\rangle&amp;\
&amp;\langle L,R\rangle_q&amp;&amp;=|L|+|R|&amp;\
&amp;\text{insert}(e,\langle L,R\rangle)&amp;&amp;=\text{makeq}\langle L, e:R\rangle\
&amp;\text{remove}\langle L,R\rangle&amp;&amp;=\langle\text{hd}\ L,\text{makeq}(\text{tl}\ L, R)\rangle\
&amp; \text{makeq}\langle L,R\rangle&amp;&amp;=\langle L,R\rangle&amp;&amp;&amp;{|R|\leq |L|}\
&amp; &amp;&amp;=\langle\text{rot}(L,R,[]), []\rangle&amp;&amp;&amp;{|R|=|L|+1}\
&amp;\text{rot}(L,R,A)&amp;&amp;=\text{hd}\ R:A &amp;&amp;&amp; {|L|=0}\
&amp; &amp;&amp;=\text{hd}\ L:\text{rot}(\text{hd}\ L,\text{tl}\ R,\text{hd}\ R:A)&amp;&amp;&amp; {|L|&gt;0}\
\end{alignat*}
$$</p>
<h4 id="代码实现-1">代码实现</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="kt">Int</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 创建一个空列表</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyList</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyList</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="mi">0</span> <span class="kt">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 添加元素到列表</span>
</span></span><span class="line"><span class="cl"><span class="nf">append</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">append</span> <span class="n">x</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="kt">:</span> <span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 获取列表的长度</span>
</span></span><span class="line"><span class="cl"><span class="nf">length&#39;</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">length&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">len</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 拼接两个 MyList</span>
</span></span><span class="line"><span class="cl"><span class="nf">concatenate</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">concatenate</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len1</span> <span class="n">xs1</span><span class="p">)</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len2</span> <span class="n">xs2</span><span class="p">)</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MyList</span> <span class="p">(</span><span class="n">len1</span> <span class="o">+</span> <span class="n">len2</span><span class="p">)</span> <span class="p">(</span><span class="n">xs1</span> <span class="o">++</span> <span class="n">xs2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 获取前 n 个元素</span>
</span></span><span class="line"><span class="cl"><span class="nf">take&#39;</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">take&#39;</span> <span class="n">n</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="p">(</span><span class="n">min</span> <span class="n">n</span> <span class="n">len</span><span class="p">)</span> <span class="p">(</span><span class="n">take</span> <span class="n">n</span> <span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">rev</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rev</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">rev&#39;</span> <span class="n">x</span> <span class="n">emptyList</span>
</span></span><span class="line"><span class="cl">  <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="kr">_</span> <span class="kt">[]</span><span class="p">)</span> <span class="n">acc</span> <span class="ow">=</span> <span class="n">acc</span>
</span></span><span class="line"><span class="cl">    <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">))</span> <span class="n">acc</span> <span class="ow">=</span> <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">xs</span><span class="p">)</span> <span class="p">(</span><span class="n">append</span> <span class="n">x</span> <span class="n">acc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="kt">PairedLazyList</span> <span class="n">a</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">a</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">newtype</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">PairedLazyList</span> <span class="n">a</span><span class="p">)</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">emptyList</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="n">x</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span> <span class="ow">=</span> <span class="n">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">append</span> <span class="n">x</span> <span class="n">tail</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">),</span> <span class="n">rear</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">),</span> <span class="n">rear</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span><span class="p">(</span><span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">),</span> <span class="n">rear</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">xs</span><span class="p">,</span> <span class="n">rear</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">makeq</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lf</span> <span class="n">xf</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">lr</span> <span class="n">xr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="n">lf</span> <span class="o">&gt;=</span> <span class="n">lr</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lf</span> <span class="n">xf</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">lr</span> <span class="n">xr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">rot</span><span class="p">(</span><span class="kt">MyList</span> <span class="n">lf</span> <span class="n">xf</span><span class="p">)</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lr</span> <span class="n">xr</span><span class="p">)</span> <span class="n">emptyList</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">)</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">concatenate</span> <span class="n">r</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">ll</span> <span class="p">(</span><span class="n">l</span><span class="kt">:</span><span class="n">xl</span><span class="p">))</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lr</span> <span class="p">(</span><span class="n">r</span><span class="kt">:</span><span class="n">xr</span><span class="p">))</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">append</span> <span class="n">l</span> <span class="p">(</span><span class="n">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">ll</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">xl</span><span class="p">)</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">lr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">xr</span><span class="p">)</span> <span class="p">(</span><span class="n">append</span> <span class="n">r</span> <span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">True</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">ll</span> <span class="kr">_</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">lr</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="n">lr</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="with-pre-evaluation">With pre-evaluation</h3>
<p>为了保证单次操作的最坏复杂度为 $O(1)$，我们需要在 $O(1)$ 的时间内得到当前查询的队尾元素。</p>
<p>因此我们需要提前预处理出可能的队尾元素，在需要时直接取出。</p>
<p>现在使用 $\langle L,R,\hat{L}\rangle$ 来表示 $q$，其中 $L,R$ 的含义与此前相同，而 $\hat{L}$ 存储的是 $L$ 的部分队尾元素，标志着 $L$ 的已评估部分和未评估部分之间的边界。</p>
<p>当 $\hat{L}=[]$ 时，整个列表的元素都已计算，而每当进行 $\text{insert}$ 和 $\text{remove}$ 操作（未触发 $\text{rot}$ ）时， 都会导致  $\hat{L}$ 移动一格，需要对下一个元素进行评估。而每次指定 $\text{rot}$ 操作后，将 $\hat{L}$ 置为 $L$。</p>
<p>我们需要保证每次执行 $\text{rot}$ 时，$\hat{L}=[]$。因此让 $|\hat{L}|=|L|-|R|$，当执行 $\text{rot}$ 时， $|L|=|R|$，此时正好 $|\hat{L}|=0$。</p>
<p>此时的操作函数为：
$$
\begin{alignat*}{3}
&amp;[]_q &amp;&amp;= \langle [],[],[]\rangle&amp;\
&amp;\langle L,R,\hat{L}\rangle_q&amp;&amp;=|L|+|R|&amp;\
&amp;\text{insert}(e,\langle L,R,\hat{L}\rangle)&amp;&amp;=\text{makeq}\langle L, e:R,\hat{L}\rangle\
&amp;\text{remove}\langle L,R,\hat{L}\rangle&amp;&amp;=\langle\text{hd}\ L,\text{makeq}(\text{tl}\ L, R,\hat{L})\rangle\
&amp; \text{makeq}\langle L,R\rangle&amp;&amp;=\langle L,R,\text{tl}\ \hat{L}\rangle&amp;&amp;&amp;{|\hat{L}|&gt; 0}\
&amp; &amp;&amp;=\text{let}\ L&rsquo;=\text{rot}(L,R,[])\ \text{in}\ \langle L&rsquo;,[],L&rsquo;\rangle&amp;&amp;&amp;{|\hat{L}|=0}\
&amp;\text{rot}(L,R,A)&amp;&amp;=\text{hd}\ R:A &amp;&amp;&amp; {|L|=0}\
&amp; &amp;&amp;=\text{hd}\ L:\text{rot}(\text{hd}\ L,\text{tl}\ R,\text{hd}\ R:A)&amp;&amp;&amp; {|L|&gt;0}\
\end{alignat*}
$$</p>
<h4 id="代码">代码</h4>
<p>需要特别注明的是，如果不需要查询队列的大小，则可以使用内置的List而非自定义MyList（因为不需要维护 $L,R,\hat{L}$ 的长度，只需要判断 $\hat{L}$ 是否为空）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nn">System.Exit</span> <span class="p">(</span><span class="nf">exitSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="kt">Int</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 创建一个空列表</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyList</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyList</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="mi">0</span> <span class="kt">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 添加元素到列表</span>
</span></span><span class="line"><span class="cl"><span class="nf">append</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">append</span> <span class="n">x</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span> <span class="kt">:</span> <span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 获取列表的长度</span>
</span></span><span class="line"><span class="cl"><span class="nf">length&#39;</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">length&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">len</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 拼接两个 MyList</span>
</span></span><span class="line"><span class="cl"><span class="nf">concatenate</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">concatenate</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len1</span> <span class="n">xs1</span><span class="p">)</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len2</span> <span class="n">xs2</span><span class="p">)</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MyList</span> <span class="p">(</span><span class="n">len1</span> <span class="o">+</span> <span class="n">len2</span><span class="p">)</span> <span class="p">(</span><span class="n">xs1</span> <span class="o">++</span> <span class="n">xs2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 获取前 n 个元素</span>
</span></span><span class="line"><span class="cl"><span class="nf">take&#39;</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">take&#39;</span> <span class="n">n</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">MyList</span> <span class="p">(</span><span class="n">min</span> <span class="n">n</span> <span class="n">len</span><span class="p">)</span> <span class="p">(</span><span class="n">take</span> <span class="n">n</span> <span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">rev</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rev</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">rev&#39;</span> <span class="n">x</span> <span class="n">emptyList</span>
</span></span><span class="line"><span class="cl">  <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="kr">_</span> <span class="kt">[]</span><span class="p">)</span> <span class="n">acc</span> <span class="ow">=</span> <span class="n">acc</span>
</span></span><span class="line"><span class="cl">    <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">))</span> <span class="n">acc</span> <span class="ow">=</span> <span class="n">rev&#39;</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">xs</span><span class="p">)</span> <span class="p">(</span><span class="n">append</span> <span class="n">x</span> <span class="n">acc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="kt">TripleLazyList</span> <span class="n">a</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">a</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">a</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">newtype</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">TripleLazyList</span> <span class="n">a</span><span class="p">)</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">emptyQueue</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">emptyList</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">push</span> <span class="n">x</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span> <span class="ow">=</span> <span class="n">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">append</span> <span class="n">x</span> <span class="n">tail</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">front</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">head</span> <span class="n">xs</span><span class="p">,</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="n">xs</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span><span class="p">(</span><span class="kt">Queue</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="nf">pop</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">len</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">),</span> <span class="n">rear</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">xs</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="n">pp</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">makeq</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Queue</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="n">newl</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">,</span> <span class="n">newl</span><span class="p">)</span> <span class="kr">where</span> <span class="n">newl</span> <span class="ow">=</span> <span class="n">rot</span> <span class="n">front</span> <span class="n">rear</span> <span class="n">emptyList</span>
</span></span><span class="line"><span class="cl"><span class="nf">makeq</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lf</span> <span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">lp</span> <span class="p">(</span><span class="n">p</span><span class="kt">:</span><span class="n">pp</span><span class="p">)))</span> <span class="ow">=</span> <span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lf</span> <span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="kt">MyList</span> <span class="p">(</span><span class="n">lp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">pp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="ow">::</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">MyList</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">)</span> <span class="n">r</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">concatenate</span> <span class="n">r</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">ll</span> <span class="p">(</span><span class="n">l</span><span class="kt">:</span><span class="n">xl</span><span class="p">))</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">lr</span> <span class="p">(</span><span class="n">r</span><span class="kt">:</span><span class="n">xr</span><span class="p">))</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">append</span> <span class="n">l</span> <span class="p">(</span><span class="n">rot</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">ll</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">xl</span><span class="p">)</span> <span class="p">(</span><span class="kt">MyList</span> <span class="p">(</span><span class="n">lr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">xr</span><span class="p">)</span> <span class="p">(</span><span class="n">append</span> <span class="n">r</span> <span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="mi">0</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">True</span>
</span></span><span class="line"><span class="cl"><span class="nf">empty</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">size</span> <span class="p">(</span><span class="kt">Queue</span> <span class="p">(</span><span class="kt">MyList</span> <span class="n">ll</span> <span class="kr">_</span><span class="p">,</span> <span class="kt">MyList</span> <span class="n">lr</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="n">lr</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="备注">备注</h2>
<p>三份代码的正确性通过 <a href="https://www.luogu.com.cn/problem/B3616" target="_blank" rel="noopener noreffer">洛谷 B3616 【模板】队列</a> 验证，没想到洛谷如今已经支持了Haskell语言的提交评测。</p>
<p>根据题目要求，代码中的交互部分如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nn">System.Exit</span> <span class="p">(</span><span class="nf">exitSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">foldM&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Monad</span> <span class="n">m</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">a</span> 
</span></span><span class="line"><span class="cl"><span class="nf">foldM&#39;</span> <span class="kr">_</span> <span class="n">z</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">return</span> <span class="n">z</span> 
</span></span><span class="line"><span class="cl"><span class="nf">foldM&#39;</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span> 
</span></span><span class="line"><span class="cl">    <span class="n">z&#39;</span> <span class="ow">&lt;-</span> <span class="n">f</span> <span class="n">z</span> <span class="n">x</span> 
</span></span><span class="line"><span class="cl">    <span class="n">z&#39;</span> <span class="p">`</span><span class="n">seq</span><span class="p">`</span> <span class="n">foldM&#39;</span> <span class="n">f</span> <span class="n">z&#39;</span> <span class="n">xs</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">opt</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span><span class="p">(</span><span class="kt">Queue</span> <span class="kt">Int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">opt</span> <span class="n">q</span> <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">input</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
</span></span><span class="line"><span class="cl">  <span class="kr">let</span> <span class="n">integers</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">read</span> <span class="p">(</span><span class="n">words</span> <span class="n">input</span><span class="p">)</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="n">head</span> <span class="n">integers</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="n">push</span> <span class="p">(</span><span class="n">integers</span> <span class="o">!!</span> <span class="mi">1</span><span class="p">)</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">pop</span> <span class="n">q</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">        <span class="n">putStrLn</span> <span class="s">&#34;ERR_CANNOT_POP&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">return</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Just</span> <span class="n">q2</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">q2</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">front</span> <span class="n">q</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Just</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">        <span class="n">return</span> <span class="n">q2</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">        <span class="n">putStrLn</span> <span class="s">&#34;ERR_CANNOT_QUERY&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">return</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">    <span class="mi">4</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">      <span class="n">print</span> <span class="p">(</span><span class="n">size</span> <span class="n">q</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">return</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">n</span> <span class="ow">&lt;-</span> <span class="n">readLn</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  <span class="kr">let</span> <span class="n">initialQueue</span> <span class="ow">=</span> <span class="p">(</span><span class="n">emptyQueue</span> <span class="ow">::</span> <span class="kt">Queue</span> <span class="kt">Int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">finalQueue</span> <span class="ow">&lt;-</span> <span class="n">foldM&#39;</span> <span class="p">(</span><span class="nf">\</span><span class="n">q</span> <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">opt</span> <span class="n">q</span><span class="p">)</span> <span class="n">initialQueue</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="n">n</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">exitSuccess</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
                </span><span><a href="/tags/haskell/">Haskell</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>更新于 2023-10-08</span>
            </div><div class="post-info-mod"><span>
                            <a class="link-to-markdown" href="/queue/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
        </div></div><div class="post-nav"><a href="/atcoder-sol/" class="prev" rel="prev" title="AtCoder Beginner Contest 自选题解"><i class="fa-solid fa-angle-left fa-fw"></i>Previous Post</a></div></div>
</div><div id="comments" class="single-card"><div id="vssue"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/meteorlxy/vssue">Vssue</a>.
            </noscript></div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.119.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.2"><i class="fa-solid fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/">SkqLiao</a></span></div>
</div>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fa-solid fa-chevron-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fa-solid fa-comment-alt fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/vue/vssue/vssue.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="/lib/vue/vue.runtime.min.js"></script><script src="/lib/vue/vssue/vssue.github.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/lg-zoom.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"vssue":{"clientID":"df793aa20495021add80","clientSecret":"bc051c8e52b85da3ecc05e7c8691b07f4f1c42ba","owner":"skqliao","repo":"vssue","title":"Simple and efficient purely functional queues and deques"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js"></script></body></html>
